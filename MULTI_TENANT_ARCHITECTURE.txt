ğŸ¯ MULTI-TENANT NESTJS BACKEND ARCHITECTURE
=============================================

âœ… SUCCESSFULLY IMPLEMENTED - PRODUCTION-READY MULTI-TENANT SYSTEM

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š DATA MODEL OVERVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. USER SCHEMA (src/users/schemas/user.schema.ts)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User                                    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ _id: ObjectId                           â”‚
   â”‚ email: string                           â”‚
   â”‚ password: string (hashed)               â”‚
   â”‚ firstName: string                       â”‚
   â”‚ lastName: string                        â”‚
   â”‚ role: SUPERADMIN | ADMIN | USER         â”‚
   â”‚ companies: ObjectId[] â†’ [Company]       â”‚
   â”‚ isActive: boolean                       â”‚
   â”‚ createdAt: Date                         â”‚
   â”‚ updatedAt: Date                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. COMPANY SCHEMA (src/companies/schemas/company.schema.ts)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Company                                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ _id: ObjectId                           â”‚
   â”‚ name: string                            â”‚
   â”‚ websiteUrl: string                      â”‚
   â”‚ phoneNumber: string                     â”‚
   â”‚ ownerId: ObjectId â†’ User                â”‚
   â”‚ members: ObjectId[] â†’ [User]            â”‚
   â”‚ products: ObjectId[] â†’ [Product]        â”‚
   â”‚ projects: ObjectId[] â†’ [Project]        â”‚
   â”‚ offers: ObjectId[] â†’ [Offer]            â”‚
   â”‚ createdAt: Date                         â”‚
   â”‚ updatedAt: Date                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. PRODUCT SCHEMA (src/products/schemas/product.schema.ts)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Product                                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ _id: ObjectId                           â”‚
   â”‚ companyId: ObjectId â†’ Company (indexed) â”‚
   â”‚ name: string                            â”‚
   â”‚ description: string                     â”‚
   â”‚ price: number                           â”‚
   â”‚ createdAt: Date                         â”‚
   â”‚ updatedAt: Date                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   * Compound Index: { companyId: 1, createdAt: -1 }

4. PROJECT SCHEMA (src/projects/schemas/project.schema.ts)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Project                                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ _id: ObjectId                           â”‚
   â”‚ companyId: ObjectId â†’ Company (indexed) â”‚
   â”‚ title: string                           â”‚
   â”‚ goal: string                            â”‚
   â”‚ createdAt: Date                         â”‚
   â”‚ updatedAt: Date                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   * Compound Index: { companyId: 1, createdAt: -1 }

5. OFFER SCHEMA (src/offers/schemas/offer.schema.ts)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Offer                                   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ _id: ObjectId                           â”‚
   â”‚ companyId: ObjectId â†’ Company (indexed) â”‚
   â”‚ title: string                           â”‚
   â”‚ discount: number                        â”‚
   â”‚ createdAt: Date                         â”‚
   â”‚ updatedAt: Date                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   * Compound Index: { companyId: 1, createdAt: -1 }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” AUTHORIZATION & GUARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. JWT AUTH GUARD (src/auth/guards/jwt-auth.guard.ts)
   - Validates JWT tokens
   - Extracts user information
   - Applied globally via APP_GUARD

2. COMPANY ACCESS GUARD (src/auth/guards/company-access.guard.ts)
   - Multi-tenant authorization guard
   - Validates company access for users
   
   Authorization Logic:
   âœ… SUPERADMIN â†’ Access to ALL companies
   âœ… OWNER â†’ Full access to their companies
   âœ… MEMBER â†’ Access to companies they're member of
   âŒ OTHERS â†’ Forbidden (403)

   Usage:
   @UseGuards(JwtAuthGuard, CompanyAccessGuard)
   
   The guard automatically:
   - Extracts companyId from route params
   - Checks if company exists
   - Validates user's access (owner/member/superadmin)
   - Returns 403 if access denied

3. ROLES GUARD (src/auth/guards/roles.guard.ts)
   - Role-based access control
   - Use with @Roles() decorator

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ›£ï¸ API ROUTES (Company-Scoped)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”¹ AUTHENTICATION
POST   /auth/register              - Create new user account
POST   /auth/login                 - Login and get JWT token
POST   /auth/superadmin            - Create superadmin (protected)

ğŸ”¹ COMPANIES
POST   /companies                                    - Create company
GET    /companies                                    - List user's companies
GET    /companies/:id                                - Get company details
PATCH  /companies/:id                                - Update company
DELETE /companies/:id                                - Delete company (Admin+)
POST   /companies/:id/members/:userId                - Add member
DELETE /companies/:id/members/:userId                - Remove member

ğŸ”¹ PRODUCTS (Company-Scoped)
POST   /companies/:companyId/products                - Create product
GET    /companies/:companyId/products                - List all products
GET    /companies/:companyId/products/:id            - Get product
PATCH  /companies/:companyId/products/:id            - Update product
DELETE /companies/:companyId/products/:id            - Delete product

ğŸ”¹ PROJECTS (Company-Scoped)
POST   /companies/:companyId/projects                - Create project
GET    /companies/:companyId/projects                - List all projects
GET    /companies/:companyId/projects/:id            - Get project
PATCH  /companies/:companyId/projects/:id            - Update project
DELETE /companies/:companyId/projects/:id            - Delete project

ğŸ”¹ OFFERS (Company-Scoped)
POST   /companies/:companyId/offers                  - Create offer
GET    /companies/:companyId/offers                  - List all offers
GET    /companies/:companyId/offers/:id              - Get offer
PATCH  /companies/:companyId/offers/:id              - Update offer
DELETE /companies/:companyId/offers/:id              - Delete offer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”’ SECURITY FEATURES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Multi-Tenant Data Isolation
   - All queries scoped to companyId
   - CompanyAccessGuard prevents cross-tenant access
   - Efficient compound indexes for performance

âœ… Role-Based Access Control (RBAC)
   - SUPERADMIN: Full system access
   - ADMIN: Extended permissions
   - USER: Company-scoped access only

âœ… Owner-Based Permissions
   - Company owners can manage their companies
   - Only owners can add/remove members
   - Members have read/write access to company resources

âœ… Validation & Error Handling
   - DTO validation using class-validator
   - Proper error responses (400, 403, 404)
   - ObjectId validation for all IDs

âœ… JWT Authentication
   - Secure token-based authentication
   - Global authentication guard
   - Public routes via @Public() decorator

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ PRACTICE TASKS COMPLETED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… 1. Data Model Design
   - All relationships properly defined
   - Bi-directional references maintained
   - Efficient indexing strategy

âœ… 2. Multi-Tenant Authorization
   - CompanyAccessGuard implemented
   - Prevents cross-tenant data access
   - SuperAdmin bypass for administrative tasks

âœ… 3. Company-Scoped CRUD APIs
   - Products module with full CRUD
   - Projects module with full CRUD
   - Offers module with full CRUD
   - All routes scoped to /companies/:companyId/...

âœ… 4. Validation & Security
   - Company ownership verification
   - User role validation
   - Proper error handling

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ PROJECT STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

src/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ jwt-auth.guard.ts           [JWT Authentication]
â”‚   â”‚   â”œâ”€â”€ company-access.guard.ts     [Multi-Tenant Authorization] â­
â”‚   â”‚   â””â”€â”€ roles.guard.ts              [Role-Based Access]
â”‚   â”œâ”€â”€ decorators/
â”‚   â”‚   â”œâ”€â”€ current-user.decorator.ts   [Extract current user]
â”‚   â”‚   â”œâ”€â”€ roles.decorator.ts          [Role metadata]
â”‚   â”‚   â””â”€â”€ public.decorator.ts         [Skip auth]
â”‚   â””â”€â”€ ...
â”œâ”€â”€ common/
â”‚   â””â”€â”€ enums/
â”‚       â””â”€â”€ role.enum.ts                [SUPERADMIN | ADMIN | USER]
â”œâ”€â”€ users/
â”‚   â””â”€â”€ schemas/
â”‚       â””â”€â”€ user.schema.ts              [User model with companies[]]
â”œâ”€â”€ companies/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ company.schema.ts           [Company with members, products, etc.]
â”‚   â”œâ”€â”€ companies.controller.ts         [Company CRUD + member management]
â”‚   â””â”€â”€ companies.service.ts            [Company business logic]
â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ product.schema.ts           [Product with companyId]
â”‚   â”œâ”€â”€ products.controller.ts          [Company-scoped CRUD] â­
â”‚   â””â”€â”€ products.service.ts             [Product business logic]
â”œâ”€â”€ projects/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ project.schema.ts           [Project with companyId]
â”‚   â”œâ”€â”€ projects.controller.ts          [Company-scoped CRUD] â­
â”‚   â””â”€â”€ projects.service.ts             [Project business logic]
â””â”€â”€ offers/
    â”œâ”€â”€ schemas/
    â”‚   â””â”€â”€ offer.schema.ts             [Offer with companyId]
    â”œâ”€â”€ offers.controller.ts            [Company-scoped CRUD] â­
    â””â”€â”€ offers.service.ts               [Offer business logic]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ HOW TO TEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Start the server:
   npm run start:dev

2. Create a user:
   POST /auth/register
   {
     "email": "user@example.com",
     "password": "password123",
     "firstName": "John",
     "lastName": "Doe"
   }

3. Login to get JWT:
   POST /auth/login
   {
     "email": "user@example.com",
     "password": "password123"
   }

4. Create a company:
   POST /companies
   Headers: Authorization: Bearer <token>
   {
     "name": "My Company",
     "websiteUrl": "https://example.com",
     "phoneNumber": "+1234567890"
   }

5. Create a product:
   POST /companies/{companyId}/products
   Headers: Authorization: Bearer <token>
   {
     "name": "Premium Laptop",
     "description": "High-performance laptop",
     "price": 999.99
   }

6. Try accessing another user's company data:
   âŒ Should return 403 Forbidden

7. Test with SuperAdmin:
   âœ… Should have access to all companies

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ KEY LEARNINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Real-world multi-tenancy pattern
âœ… Company-scoped resource management
âœ… Custom authorization guards
âœ… Role-based access control
âœ… Proper data isolation
âœ… Efficient database indexing
âœ… RESTful API design
âœ… TypeScript best practices
âœ… NestJS architectural patterns

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ NEXT STEPS (Optional Enhancements)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Add pagination to list endpoints
2. Implement soft delete for companies
3. Add company member roles (viewer, editor, admin)
4. Implement audit logs for company actions
5. Add company invitation system
6. Implement resource-level permissions
7. Add API rate limiting per company
8. Implement company-specific quotas
9. Add full-text search for products
10. Implement company settings and preferences

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ This is a production-ready multi-tenant architecture that 
   demonstrates enterprise-level backend security patterns! âœ¨

